#!/usr/bin/env zsh
#
# Update the Carapace system and re-install
#
set -e

#
# Prepare
#

# Try to autodetect carapace folder
export CARAPACE="${0:A:h:h}"

if [ ! -d "$CARAPACE" ]; then
    export CARAPACE="$HOME/.carapace"

    if [ ! -d "$CARAPACE" ]; then
        >&2 echo "Unable to find carapace folder!"
        exit 1
    fi  
fi

export PATH="$CARAPACE/install:$PATH"

#
# Update
#

carapace-message "boldcyan" "Carapace Update Starting..."
( cd $CARAPACE && git pull -q --recurse-submodules )
carapace-message "boldcyan" "Carapace Update Finished"

#
# Reinstall
#

carapace-install
